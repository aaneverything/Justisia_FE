name : frontend cicd

on :
    push :
        branches :
            - main
    pull_request :
        branches :
            - main
permissions :
    contents: read

jobs :
    deploy :
        runs-on : ubuntu-latest
        steps :
            - uses : actions/checkout@v4

            - name: Setup SSH
              uses: webfactory/ssh-agent@v0.9.0
              with:
                ssh-private-key: ${{ secrets.SSH_KEY }}

            - name: Add known hosts
              run: | 
                ssh-keyscan -H ${{ secrets.VPS_HOST }} >> ~/.ssh/known_hosts

            - name : Deploy
              run: |
                ssh -A -o StrictHostKeyChecking=no ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }} << 'EOF'
                cd /home/aan/Justisia_FE
                git pull origin main
                docker compose down 
                docker compose build --no-cache
                docker compose up -d
                EOF

